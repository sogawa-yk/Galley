# プロダクト要求定義書（Product Requirements Document）

## 1. プロダクトビジョンと目的

### ビジョン

自社クラウドのプリセールスエンジニアが、顧客向けデモのアーキテクチャ設計を **「数日」から「数十分」** に短縮できるAI支援システムを実現する。

### スコープの境界

- **対象クラウド**: 自社クラウド（OCI）を前提とする。マルチクラウド対応は将来検討事項
- **「デモ」の定義**: インフラアーキテクチャ構成のデモを対象とする。アプリケーションコードの生成は対象外。MVP段階ではアーキテクチャ設計ドキュメント（構成図・IaCテンプレート）の生成までをスコープとし、実環境へのデプロイは含まない
- **提供形態**: MCPサーバーとして提供し、ユーザーは各自のAIクライアント（Claude Desktop、ChatGPT等）から利用する。専用UIは構築しない

### 目的

プリセールスエンジニアが日常的に行う以下の業務を、MCPサーバーを通じたAI支援で加速・自動化する。

- 顧客要件のヒアリングと構造化
- 要件に基づくクラウドアーキテクチャの設計
- 設計ドキュメント（要件サマリー・構成図・IaCテンプレート）の生成

### プロダクト名

**Galley（ゲラ）**

> 名前の由来: 印刷用語で「校正刷り」を意味する。本番前の試作版を素早く作り上げ、確認・修正を経て世に出すプロセスが、プリセールスにおけるデモ作成のワークフローと重なる。

---

## 2. ターゲットユーザーと課題・ニーズ

### ターゲットユーザー

自社クラウドベンダーに所属するプリセールスエンジニア（技術営業）

### ペルソナ

| 項目 | 内容 |
|------|------|
| 役職 | プリセールスエンジニア / ソリューションアーキテクト |
| 経験年数 | クラウド技術 3年以上 |
| 並行案件数 | 常時 3〜5件 |
| 1案件あたりのデモ準備時間 | 現状 2〜5営業日（ヒアリング〜設計ドキュメント作成まで） |
| 主な利用シーン | 顧客訪問・打ち合わせの **前** に、提案用のアーキテクチャ設計を準備する |
| 想定利用頻度 | 週 2〜3回（新規案件・既存案件の設計見直し） |
| 技術スキル | 自社クラウドサービスに精通。IaCやアーキテクチャ設計パターンを理解している |
| AIクライアント利用経験 | Claude Desktop、ChatGPT等のAIクライアントを日常的に使用している |

### 現状の対処方法（Galley導入前）

| 作業 | 現在の方法 | 課題 |
|------|-----------|------|
| 要件ヒアリング | 対面/オンライン会議で口頭確認、議事録を手書き | 聞き漏れが発生。構造化されていないため後工程で手戻り |
| アーキテクチャ設計 | 過去資料をコピーして手動で修正。個人のローカルに散在 | 類似案件の検索が困難。属人化 |
| 構成図作成 | PowerPoint / draw.io で手作業 | 時間がかかる。要件変更のたびに作り直し |
| IaCテンプレート | 過去のテンプレートをコピー&修正、またはゼロから作成 | 再利用の仕組みがなく毎回手間がかかる |

### 課題

| # | 課題 | 詳細 |
|---|------|------|
| 1 | デモ準備に時間がかかる | 顧客要件のヒアリング、アーキテクチャ設計、ドキュメント作成に2〜5営業日を要する |
| 2 | 要件定義の認知負荷が高い | 自然言語で要件を詳細に記述するのは負荷が高く、聞き漏れも発生しやすい |
| 3 | 「わからない」で止まる | 顧客自身が要件を明確にできていない段階でも、デモ準備を前に進める必要がある |
| 4 | ナレッジが属人化している | 過去の案件知見・意思決定の背景が個人の頭の中にのみ存在する |
| 5 | 類似案件の再利用が困難 | 過去のデモ環境やアーキテクチャを検索・再利用する仕組みがない |

### ニーズ

- 要件ヒアリングからアーキテクチャ決定、アウトプット生成までを一気通貫で高速化したい
- 不明点があっても妥当な推測で前に進み、後から修正できる柔軟性が欲しい
- 過去の案件知見を組織的に蓄積・再利用したい

---

## 3. 主要な機能一覧

### 全体像（将来構想含む）

| # | 機能領域 | 概要 | MVP対象 |
|---|----------|------|---------|
| F1 | 対話型ヒアリング（選択式ウィザード） | AIが選択式の質問を通じて要件を段階的に具体化する | **Yes** |
| F2 | アーキテクチャ生成 | ヒアリング結果からクラウドアーキテクチャを自動設計する | **Yes** |
| F3 | アウトプット生成 | 要件サマリー・構成図・IaCテンプレート等を自動生成する | **Yes** |
| F4 | デモ環境の自動構築・管理 | IaCテンプレートからデモ環境をデプロイ・管理する | No |
| F5 | 技術検証（PoC）の加速 | クラウドリソースの自動操作・検証結果の自動レポート生成 | No |
| F6 | 提案資料・ドキュメント生成 | アーキテクチャ構成図・技術比較表・RFP対応支援 | No |
| F7 | ライブデモ支援 | デモ中のリアルタイムアシスタント・障害シミュレーション | No |
| F8 | 社内ナレッジハブ | 社内資料の横断検索・ナレッジ蓄積と再利用 | No |

---

## 4. 成功指標

### MVP段階（個人利用）

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| ヒアリング完了時間 | 10分以内 | 初回入力から要件サマリー生成までの所要時間 |
| アーキテクチャ採用率 | 70%以上 | 生成結果を修正なし or 軽微な修正（コンポーネント2箇所以内の変更）で採用した割合 |
| 週あたり利用回数 | 2回以上 | 実際の案件準備で使用した回数（定着の指標） |
| IaCテンプレート構文正当性 | 90%以上 | 生成テンプレートがバリデーションを通過する割合 |

### チーム展開段階

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| オンボーディング時間 | 30分以内 | 初回利用者がMCPサーバーをセットアップし、1案件のアウトプットを生成するまでの時間 |
| チーム利用率 | 50%以上 | チームメンバーのうち月1回以上利用する割合 |
| 推測根拠の社内実績カバー率 | 30%以上 | 推測補完時に社内実績が根拠として使われた割合 |

### 社内展開段階

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| 案件DB連携率 | 80%以上 | 生成した設計が案件DBに自動登録される割合 |
| デモ準備の平均所要時間 | 現状比 60%削減 | ヒアリング〜デモ環境準備完了までの時間を案件DBで計測 |

---

## 5. ビジネス要件

### 利用形態

- 初期: 個人利用（開発者本人のみ、自身のAIクライアントで利用）
- 中期: チーム内展開（同一チームのプリセールスエンジニアが各自のAIクライアントで利用）
- 将来: 社内展開

### 運用要件

- MVP段階ではサーバーインフラ不要（MCPサーバーはローカル実行）
- チーム展開以降、共有ナレッジストアのためのサーバーインフラを検討

### セキュリティ要件

- 各自のAIクライアントにデータが送信されるため、顧客の機密情報（社名、契約金額等）の取り扱いルールを定める
- AIクライアントごとのデータポリシーの違いに注意（各ユーザーの責任で利用規約を確認）
- MVP段階ではヒアリング結果はローカルファイルに保存し、外部に送信しない

### コスト要件

- MVP段階は追加のインフラ費用なし（各自が契約しているAIクライアントの費用のみ）
- MCPサーバーの配布はnpxコマンドやパッケージマネージャ経由とし、追加費用を発生させない

---

## 6. ユーザーストーリー

### MVP対象

優先度はMoSCoW法で分類する。

| # | ユーザーストーリー | 優先度 | 実装順 |
|---|-------------------|--------|--------|
| US1 | プリセールスエンジニアとして、普段使っているAIクライアントで案件の概要を伝えると、選択式の質問で要件を具体化してほしい。要件定義の認知負荷を下げ、聞き漏れを防ぐためだ。 | Must | 1 |
| US2 | プリセールスエンジニアとして、「わからない」と答えた項目に対して根拠付きの推測を提示してほしい。不明点があってもデモ準備を前に進めるためだ。 | Must | 2 |
| US4 | プリセールスエンジニアとして、ヒアリング結果からクラウドアーキテクチャを自動生成してほしい。設計作業を高速化するためだ。 | Must | 3 |
| US5 | プリセールスエンジニアとして、確定事項・推測・未確認を区別した要件サマリーを得たい。顧客への次回ヒアリング項目を明確にするためだ。 | Must | 4 |
| US3 | プリセールスエンジニアとして、推測の根拠の信頼度を確認したい。顧客に説明できる裏付けが必要だからだ。 | Should | 5 |
| US6 | プリセールスエンジニアとして、アーキテクチャの構成図（Mermaid等）を自動生成してほしい。提案資料に活用するためだ。 | Should | 6 |
| US7 | プリセールスエンジニアとして、IaCテンプレートのドラフトを自動生成してほしい。デモ環境構築の出発点とするためだ。 | Could | 7 |

### 将来対象

| # | ユーザーストーリー | 優先度 |
|---|-------------------|--------|
| US8 | プリセールスエンジニアとして、過去の類似案件での選択傾向をレコメンドとして見たい。意思決定を加速するためだ。 | Should |
| US9 | プリセールスエンジニアとして、デモ作成のたびにナレッジが自動蓄積されてほしい。チーム全体の知見を底上げするためだ。 | Should |
| US10 | プリセールスエンジニアとして、IaCテンプレートから直接デモ環境をデプロイしたい。環境構築の手間を省くためだ。 | Could |

---

## 7. 受け入れ条件

### US1: 選択式ヒアリング

- 案件の概要を自然言語で入力すると、AIが番号付き選択肢の質問を順次提示する
- 質問は10問程度（8〜12問）で完了する
- 各質問に「その他（自由入力）」の選択肢がある
- 前の回答に応じて後続の質問が動的に変化する
- セッションを中断しても、保存済みのヒアリング結果から再開できる

### US2: 推測による補完

- 「わからない」を選択した場合、AIが根拠付きの推測値を提示する
- 推測値に対して「この仮定で進める」「調整する」を選択できる
- MVP段階の推測根拠はAIクライアント（LLM）自身の知識に基づく一般推計とする（社内実績はチーム展開段階で対応）

### US3: 推測の根拠表示

推測根拠の信頼度ラベルは段階的に拡充する。

| 信頼度ラベル | MVP段階 | チーム展開段階 |
|-------------|---------|--------------|
| 公開事例（公開事例・リファレンスアーキテクチャに基づく） | 対応 | 対応 |
| 一般推計（業界の一般的なベストプラクティスに基づく） | 対応 | 対応 |
| 社内実績（社内過去案件の統計データに基づく） | **非対応** | 対応 |

- 根拠の具体的なソース情報（参照元の説明）が確認できる
- ソースが見つからない場合は「根拠となる情報が見つかりませんでした」と明示する（ハルシネーション防止）

### US4: アーキテクチャ自動生成

- ヒアリング結果からOCIのアーキテクチャが生成される
- 主要コンポーネント（コンピュート、DB、ネットワーク、認証、ストレージ、監視）が含まれる
- 各コンポーネントの選定理由が説明される
- 生成結果は人間レビュー前提であり、自動デプロイはしない

### US5: 要件サマリー

- 確定事項（ユーザーが明示的に選択した項目）が区別して表示される
- 推測に基づく仮定（根拠付き）が区別して表示される
- 未確認項目（デモ後にヒアリング推奨）が区別して表示される
- サマリーは「次回の顧客ヒアリングで確認すべき事項リスト」としても機能する

### US6: 構成図生成

- Mermaid記法でアーキテクチャ構成図が出力される
- 主要コンポーネントとその接続関係が表現される
- OCI固有のサービス名で記載される

### US7: IaCテンプレート生成

- OCI向けのIaCテンプレート（Terraform / OCI Resource Manager）が出力される
- テンプレートは `terraform validate` を通過する構文正当性を目標とする
- パラメータ化（`variables.tf`）されており、環境ごとのカスタマイズが容易
- 生成結果はローカルファイルに出力される

---

## 8. 機能要件

### F1: 対話型ヒアリング（選択式ウィザード）

#### 質問カテゴリ（MVP初期セット）

以下のカテゴリを基本とし、案件種別に応じてAIクライアント（LLM）が取捨選択・順序変更する。

| # | カテゴリ | 質問の目的 | 必須/条件付き |
|---|---------|-----------|-------------|
| Q1 | 案件概要 | 業種、案件の種類（新規構築/移行/モダナイゼーション） | 必須 |
| Q2 | 規模 | 想定ユーザー数、同時接続数 | 必須 |
| Q3 | トラフィック特性 | スパイクの有無・予測可能性 | 必須 |
| Q4 | データベース | 既存DB、移行要件、データ量 | 必須 |
| Q5 | ネットワーク | マルチリージョン、オンプレ接続、VPN/専用線 | 必須 |
| Q6 | セキュリティ・認証 | 認証方式、コンプライアンス要件 | 必須 |
| Q7 | 可用性・DR | SLA目標、DR要件、バックアップ方針 | 必須 |
| Q8 | パフォーマンス | レイテンシ要件、スループット要件 | 条件付き（規模に依存） |
| Q9 | 運用・監視 | ログ管理、監視要件、ログ保持期間 | 条件付き |
| Q10 | 予算・スケジュール | コスト制約、デモ期限 | 必須 |

#### 質問生成

- 質問カテゴリと順序はMCPサーバーが提供するテンプレート（Resources）で定義する
- 具体的な選択肢と質問文はAIクライアント（LLM）がコンテキスト（案件概要・前の回答）に応じて動的に生成する
- 質問は番号付き選択肢としてテキストで提示する（例: 「1. 製造業 2. 小売・EC 3. 物流 4. その他」）

#### 回答の依存関係

- 前の回答に基づいて後続の質問が変化する（有向グラフの探索）
- AIクライアント（LLM）がナビゲーターとして分岐を制御する
- 例: 「マルチリージョン: Yes」→「レプリケーション戦略は？」が追加

#### モード切り替え

- 選択肢では表現しきれない特殊要件に対応するため、各質問で自由入力も受け付ける

### F2: アーキテクチャ生成

- ヒアリング結果を入力として、OCIのアーキテクチャを設計する
- 各コンポーネントの選定理由を付記する
- 非機能要件（可用性、スケーラビリティ、セキュリティ等）を考慮した構成とする
- 生成結果は人間レビュー前提。自動的に環境に反映することはしない
- アーキテクチャの妥当性チェックとして、既知のアンチパターン（単一障害点、セキュリティグループの全開放等）を検出し警告する

### F3: アウトプット生成

- **要件サマリー**: 確定/推測/未確認の3区分で整理
- **構成図**: Mermaid記法で出力（OCIサービス名を使用）
- **IaCテンプレート**: Terraform（OCI Provider）形式で出力（MVP段階ではドラフト品質）
- **ファイル出力**: 生成結果はMCPサーバーのToolを通じてローカルファイルに保存

---

## 9. 非機能要件

### パフォーマンス

- ヒアリングの1問あたりの応答時間: AIクライアントのLLM応答速度に依存（MCPサーバー側の処理は1秒以内）
- ファイルI/O（セッション保存・読み込み）: 即座に完了

### 可用性

- MCPサーバーはローカル実行のため、ネットワーク障害の影響を受けない
- AIクライアントの可用性に依存する

### セキュリティ

- ヒアリングデータはローカルファイルシステムに保存され、MCPサーバー自体は外部通信しない
- AIクライアントへの送信データに顧客の機密情報を含めない運用ルールを設ける
- MCPサーバーのPrompts（システムプロンプト）に「顧客固有名詞を匿名化して入力する」ガイダンスを含める
- 認証・認可はチーム展開段階で共有ナレッジストア導入時に検討

### データ永続性

- MVP段階: ヒアリング結果・生成物はローカルファイルシステム（JSON）に保存
- セッション一覧の管理もローカルファイルベース
- ファイルエクスポート/インポートによるセッション共有が可能
- チーム展開段階: 共有ナレッジストア（RDB + ベクトルDB）への接続を検討

### AIクライアント互換性

- MCPプロトコルに準拠したAIクライアントであれば動作する
- 動作確認対象: Claude Desktop（主要）、その他MCP対応クライアント
- AIクライアントのLLM性能（構造化出力能力、コンテキスト長等）によって体験品質が変わる可能性がある

### トークン/コスト管理

- MCPサーバーが提供するResources（質問テンプレート、OCIリファレンス等）のサイズを最適化し、不要なトークン消費を抑制する
- コスト管理は各ユーザーのAIクライアント契約に委ねる

### 国際化

- MVP段階: 日本語のみ（質問テンプレート、プロンプト、OCIリファレンスすべて日本語）
- チーム展開段階: 英語対応を検討（海外案件のヒアリングに対応するため）

### 監査・ログ

- MVP段階: セッションファイルの保存履歴がそのまま操作ログとなる
- チーム展開段階: 共有ナレッジストア導入時に操作ログの集約を検討

### 拡張性

- ヒアリング結果のJSONスキーマを最初から厳密に定義し、後続処理（アーキテクチャ生成・IaC生成・将来のナレッジ蓄積）の基盤とする
- MCPサーバーのResources/Tools/Promptsを追加するだけで機能拡張が可能な設計とする

### 保守性

- ヒアリングの質問テンプレートは外部設定（JSON/YAML）として管理し、コード変更なしで更新可能とする
- MCPサーバーのPromptsも外部ファイルとして管理する

### 配布・インストール

- MCPサーバーはnpmパッケージとして配布し、npxコマンドまたはパッケージインストールで利用開始できる
- AIクライアントの設定ファイルに追加する手順をドキュメント化する
- 依存関係は最小限にし、Node.jsのみで動作する

---

## 10. 展開ロードマップ

```
Phase 1: 個人利用MVP
  → MCPサーバー（galley-hearing / galley-generate）の開発
  → コアフロー（ヒアリング → アーキテクチャ → アウトプット）
  → AIクライアント（LLM）の知識ベースの推測根拠
  → ローカルファイルによるデータ保存

Phase 2: チーム展開
  → MCPサーバーのnpmパッケージ化・配布
  → 既存PPTX等からのナレッジ抽出パイプライン
  → ナレッジを活用したレコメンドと推測根拠の強化（社内実績ラベル対応）
  → 共有ナレッジストアの導入
  → 操作ログの集約

Phase 3: 社内展開
  → 案件DB連携
  → デモ環境の自動構築・管理（OCI CLI連携MCPサーバーの追加）
  → ライブデモ支援、提案資料の自動生成
  → 「使いながら溜まる」ナレッジ循環の確立
  → 必要に応じて専用WebUIの構築を検討
```
