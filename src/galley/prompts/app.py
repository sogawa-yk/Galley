"""アプリケーション層のMCPプロンプト定義。"""

from fastmcp import FastMCP


def register_app_prompts(mcp: FastMCP) -> None:
    """アプリケーション関連のMCPプロンプトを登録する。"""

    @mcp.prompt()
    async def template_selection(session_id: str) -> str:
        """テンプレート選択をガイドするプロンプト。

        ヒアリング結果と設計済みアーキテクチャに基づいて、
        最適なテンプレートの選択とカスタマイズをガイドします。

        Args:
            session_id: セッションID。
        """
        return (
            f"セッション `{session_id}` のアーキテクチャに適したアプリケーションテンプレートを選択します。\n\n"
            "## 手順\n\n"
            "1. `list_templates` ツールで利用可能なテンプレート一覧を取得してください。\n"
            "2. `get_hearing_result` ツールでヒアリング結果を確認してください。\n"
            "3. ヒアリング結果とアーキテクチャに最適なテンプレートを選択してください。\n"
            "4. `scaffold_from_template` ツールでプロジェクトを生成してください。\n\n"
            "## テンプレート選択の基準\n\n"
            "- アーキテクチャのコンポーネント構成に合ったテンプレートを選択\n"
            "- データベースの種類（ADB、MySQL等）に応じたテンプレートを優先\n"
            "- カスタマイズパラメータを適切に設定\n"
        )

    @mcp.prompt()
    async def app_customization(session_id: str) -> str:
        """アプリケーションカスタマイズをガイドするプロンプト。

        テンプレートから生成したアプリケーションのカスタマイズフローを
        ガイドします。

        Args:
            session_id: セッションID。
        """
        return (
            f"セッション `{session_id}` のアプリケーションをカスタマイズします。\n\n"
            "## 手順\n\n"
            "1. 生成されたプロジェクトのファイル構成を確認してください。\n"
            "2. 顧客要件に合わせてコードを修正してください。\n"
            "3. `update_app_code` ツールでファイルを更新してください。\n\n"
            "## 注意事項\n\n"
            "- テンプレートのコア部分（DB接続設定、認証周り等）は保護されており変更できません。\n"
            "- 変更前のコードは自動的にスナップショット保存されます。\n"
            "- 変更はapp/ディレクトリからの相対パスで指定してください。\n"
        )

    @mcp.prompt()
    async def app_deploy(session_id: str) -> str:
        """アプリケーションデプロイをガイドするプロンプト。

        ビルド・デプロイフローをガイドします。

        Args:
            session_id: セッションID。
        """
        return (
            f"セッション `{session_id}` のアプリケーションをデプロイします。\n\n"
            "## 手順\n\n"
            "1. カスタマイズが完了していることを確認してください。\n"
            "2. `build_and_deploy` ツールでビルド・デプロイを実行してください。\n"
            "3. `check_app_status` ツールでデプロイ状態を確認してください。\n\n"
            "## デプロイ後の確認\n\n"
            "- エンドポイントにアクセスして動作を確認してください。\n"
            "- ヘルスチェックが正常であることを確認してください。\n"
            "- デプロイに失敗した場合、自動ロールバックが実行されます。\n"
        )
