# ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

## ğŸš¨ ã‚¿ã‚¹ã‚¯å®Œå…¨å®Œäº†ã®åŸå‰‡

**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã¾ã§ä½œæ¥­ã‚’ç¶™ç¶šã™ã‚‹ã“ã¨**

### å¿…é ˆãƒ«ãƒ¼ãƒ«
- **å…¨ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’`[x]`ã«ã™ã‚‹ã“ã¨**
- ã€Œæ™‚é–“ã®éƒ½åˆã«ã‚ˆã‚Šåˆ¥ã‚¿ã‚¹ã‚¯ã¨ã—ã¦å®Ÿæ–½äºˆå®šã€ã¯ç¦æ­¢
- ã€Œå®Ÿè£…ãŒè¤‡é›‘ã™ãã‚‹ãŸã‚å¾Œå›ã—ã€ã¯ç¦æ­¢
- æœªå®Œäº†ã‚¿ã‚¹ã‚¯ï¼ˆ`[ ]`ï¼‰ã‚’æ®‹ã—ãŸã¾ã¾ä½œæ¥­ã‚’çµ‚äº†ã—ãªã„

### å®Ÿè£…å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã®ã¿ã‚’è¨ˆç”»
- è¨ˆç”»æ®µéšã§ã€Œå®Ÿè£…å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã€ã®ã¿ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
- ã€Œå°†æ¥ã‚„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‚¿ã‚¹ã‚¯ã€ã¯å«ã‚ãªã„
- ã€Œæ¤œè¨ä¸­ã®ã‚¿ã‚¹ã‚¯ã€ã¯å«ã‚ãªã„

### ã‚¿ã‚¹ã‚¯ã‚¹ã‚­ãƒƒãƒ—ãŒè¨±å¯ã•ã‚Œã‚‹å”¯ä¸€ã®ã‚±ãƒ¼ã‚¹
ä»¥ä¸‹ã®æŠ€è¡“çš„ç†ç”±ã«è©²å½“ã™ã‚‹å ´åˆã®ã¿ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½:
- å®Ÿè£…æ–¹é‡ã®å¤‰æ›´ã«ã‚ˆã‚Šã€æ©Ÿèƒ½è‡ªä½“ãŒä¸è¦ã«ãªã£ãŸ
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ã«ã‚ˆã‚Šã€åˆ¥ã®å®Ÿè£…æ–¹æ³•ã«ç½®ãæ›ã‚ã£ãŸ
- ä¾å­˜é–¢ä¿‚ã®å¤‰æ›´ã«ã‚ˆã‚Šã€ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œä¸å¯èƒ½ã«ãªã£ãŸ

ã‚¹ã‚­ãƒƒãƒ—æ™‚ã¯å¿…ãšç†ç”±ã‚’æ˜è¨˜:
```markdown
- [x] ~~ã‚¿ã‚¹ã‚¯å~~ï¼ˆå®Ÿè£…æ–¹é‡å¤‰æ›´ã«ã‚ˆã‚Šä¸è¦: å…·ä½“çš„ãªæŠ€è¡“çš„ç†ç”±ï¼‰
```

### ã‚¿ã‚¹ã‚¯ãŒå¤§ãã™ãã‚‹å ´åˆ
- ã‚¿ã‚¹ã‚¯ã‚’å°ã•ãªã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²
- åˆ†å‰²ã—ãŸã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
- ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’1ã¤ãšã¤å®Œäº†ã•ã›ã‚‹

---

## ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ›´

- [x] `Session`ãƒ¢ãƒ‡ãƒ«ã«`rm_stack_id: str | None = None`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
  - [x] `src/galley/models/session.py`ã‚’ç·¨é›†

- [x] IaCãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’RMäº’æ›ã«å¤‰æ›´ï¼ˆ`design.py`ï¼‰
  - [x] `variable "compartment_id"` â†’ `variable "compartment_ocid"` ã«ãƒªãƒãƒ¼ãƒ 
  - [x] `variable "tenancy_ocid"` ã‚’è¿½åŠ ï¼ˆç©ºå®šç¾©ã€RMè‡ªå‹•å…¥åŠ›ç”¨ï¼‰
  - [x] providerãƒ–ãƒ­ãƒƒã‚¯ã‹ã‚‰authè¡Œã¨ç’°å¢ƒå¤‰æ•°åˆ¤å®šã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆ`region = var.region`ã®ã¿ï¼‰
  - [x] `_TF_RESOURCE_TEMPLATES`å†…ã®`var.compartment_id`å‚ç…§ã‚’`var.compartment_ocid`ã«å¤‰æ›´
  - [x] ~~`_TF_DEFAULTS`å†…ã®`compartment_id`ã‚­ãƒ¼ã‚’`compartment_ocid`ã«å¤‰æ›´ï¼ˆè©²å½“ã‚ã‚Œã°ï¼‰~~ï¼ˆè©²å½“ãªã—: _TF_DEFAULTSã«compartment_idé–¢é€£ã®ã‚¨ãƒ³ãƒˆãƒªã¯å­˜åœ¨ã—ãªã„ï¼‰
  - [x] `terraform.tfvars.example`ã®`compartment_id` â†’ `compartment_ocid`ã‚’æ›´æ–°
  - [x] `import os`ã‚’å‰Šé™¤ï¼ˆä¸è¦ã«ãªã‚‹ãŸã‚ï¼‰

- [x] æ—¢å­˜design.pyãƒ†ã‚¹ãƒˆã®ä¿®æ­£
  - [x] `compartment_id`ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã‚’`compartment_ocid`ã«æ›´æ–°
  - [x] auth/ResourcePrincipalé–¢é€£ãƒ†ã‚¹ãƒˆã‚’ã€ŒauthãŒå«ã¾ã‚Œãªã„ã“ã¨ã€ã«å¤‰æ›´
  - [x] å…¨ãƒ†ã‚¹ãƒˆé€šéã‚’ç¢ºèª

## ãƒ•ã‚§ãƒ¼ã‚º2: InfraService RMå®Ÿè£…

- [x] RMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
  - [x] `_rm_client`å±æ€§ã‚’`__init__`ã«è¿½åŠ ï¼ˆ`None`ã§åˆæœŸåŒ–ï¼‰
  - [x] `_get_rm_client()`ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼ˆResourcePrincipal / API Keyè‡ªå‹•é¸æŠï¼‰

- [x] zipåŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼å®Ÿè£…
  - [x] `_zip_terraform_dir(terraform_dir: Path) -> str` å®Ÿè£…ï¼ˆbase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿zipè¿”å´ï¼‰
  - [x] `.terraform/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨`*.tfstate*`ã‚’é™¤å¤–
  - [x] zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å†…ã®ãƒ‘ã‚¹ã‚’ç›¸å¯¾ãƒ‘ã‚¹ã«ã™ã‚‹

- [x] RMè‡ªå‹•å…¥åŠ›å¤‰æ•°ã®é™¤å¤–ãƒ˜ãƒ«ãƒ‘ãƒ¼
  - [x] `_filter_rm_auto_variables(variables: dict) -> dict` å®Ÿè£…
  - [x] `region`, `compartment_ocid`, `tenancy_ocid`, `current_user_ocid`ã‚’é™¤å¤–

- [x] ã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†å®Ÿè£…
  - [x] `_ensure_rm_stack(session_id, terraform_dir, variables) -> str` å®Ÿè£…
  - [x] ã‚¹ã‚¿ãƒƒã‚¯æœªä½œæˆæ™‚: `create_stack`ï¼ˆzip + variables + terraform_version=1.5.xï¼‰
  - [x] ã‚¹ã‚¿ãƒƒã‚¯æ—¢å­˜æ™‚: `update_stack`ï¼ˆzip + variablesæ›´æ–°ï¼‰
  - [x] ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆIDã®å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç’°å¢ƒå¤‰æ•° or variablesã‹ã‚‰ï¼‰
  - [x] stack_idã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ï¼ˆ`session.rm_stack_id`ã‚’æ›´æ–°ã—ã¦æ°¸ç¶šåŒ–ï¼‰

- [x] ã‚¸ãƒ§ãƒ–å®Ÿè¡Œãƒ»ãƒãƒ¼ãƒªãƒ³ã‚°å®Ÿè£…
  - [x] `_run_rm_job(stack_id, operation, command) -> TerraformResult` å®Ÿè£…
  - [x] Plan/Apply/Destroyã®ã‚¸ãƒ§ãƒ–ä½œæˆï¼ˆ`CreateJobDetails`ï¼‰
  - [x] Applyã¯`execution_plan_strategy=AUTO_APPROVED`
  - [x] Destroyã‚‚`execution_plan_strategy=AUTO_APPROVED`
  - [x] `get_job`ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ5ç§’é–“éš”ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆplan 5åˆ†/apply,destroy 30åˆ†ï¼‰
  - [x] `get_job_logs`ã§ãƒ­ã‚°å–å¾— â†’ stdoutæ–‡å­—åˆ—ã«çµåˆ
  - [x] SUCCEEDED/FAILEDã«å¿œã˜ã¦TerraformResultæ§‹ç¯‰
  - [x] plan_summaryã®æŠ½å‡ºï¼ˆæ—¢å­˜`_extract_plan_summary`ã‚’å†åˆ©ç”¨ï¼‰

- [x] `run_terraform_plan`ã‚’RMçµŒç”±ã«æ›¸ãæ›ãˆ
  - [x] zipåŒ– â†’ `_ensure_rm_stack` â†’ `_run_rm_job("PLAN")` â†’ TerraformResultè¿”å´
  - [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒã‚§ãƒƒã‚¯ã¨æ’ä»–ãƒ­ãƒƒã‚¯ã¯ç¶­æŒ

- [x] `run_terraform_apply`ã‚’RMçµŒç”±ã«æ›¸ãæ›ãˆ
  - [x] zipåŒ– â†’ ã‚¹ã‚¿ãƒƒã‚¯æ›´æ–°ï¼ˆå¤‰æ›´ã‚ã‚Œã°ï¼‰ â†’ `_run_rm_job("APPLY")` â†’ TerraformResultè¿”å´

- [x] `run_terraform_destroy`ã‚’RMçµŒç”±ã«æ›¸ãæ›ãˆ
  - [x] `_run_rm_job("DESTROY")` â†’ TerraformResultè¿”å´

- [x] `get_rm_job_status`ã‚’å®Ÿè£…
  - [x] `get_job`ã§ã‚¸ãƒ§ãƒ–çŠ¶æ…‹å–å¾—
  - [x] `get_job_logs`ã§ãƒ­ã‚°å–å¾—
  - [x] RMJobå½¢å¼ + ãƒ­ã‚°ã§è¿”å´

- [x] ä¸è¦ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
  - [x] `_ensure_terraform_init`ã‚’å‰Šé™¤ï¼ˆRMå´ã§ä¸è¦ï¼‰
  - [x] `_build_terraform_args`ã‚’å‰Šé™¤ï¼ˆRMå´ã§ä¸è¦ï¼‰
  - [x] `_run_subprocess`ã®terraformé–¢é€£ç”¨é€”ã‚’å‰Šé™¤ï¼ˆOCI CLIç”¨é€”ã¯ç¶­æŒï¼‰
  - [x] `create_rm_stack`, `run_rm_plan`, `run_rm_apply`ã®ã‚¹ã‚¿ãƒ–ã‚’å‰Šé™¤
  - [x] `oci_sdk_call`ã®ã‚¹ã‚¿ãƒ–ã‚’å‰Šé™¤

## ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ„ãƒ¼ãƒ«å±¤ã®æ›´æ–°

- [x] `tools/infra.py`ã®æ›´æ–°
  - [x] `run_terraform_plan/apply/destroy`ã®docstringã‚’RMçµŒç”±ã®èª¬æ˜ã«æ›´æ–°
  - [x] `create_rm_stack`, `run_rm_plan`, `run_rm_apply`ãƒ„ãƒ¼ãƒ«ã‚’å‰Šé™¤
  - [x] `oci_sdk_call`ãƒ„ãƒ¼ãƒ«ã‚’å‰Šé™¤
  - [x] `get_rm_job_status`ã®docstringã‚’æ›´æ–°ï¼ˆå®Ÿè£…æ¸ˆã¿ã®èª¬æ˜ã«ï¼‰

## ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆæ›´æ–°

- [x] æ—¢å­˜infra.pyãƒ†ã‚¹ãƒˆã®ä¿®æ­£
  - [x] ãƒ­ãƒ¼ã‚«ãƒ«Terraformå®Ÿè¡Œã®ãƒ†ã‚¹ãƒˆã‚’RMçµŒç”±ã®ãƒ¢ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã«æ›¸ãæ›ãˆ
  - [x] `TestRunTerraformPlan`: RMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯ã—ã¦plançµæœæ¤œè¨¼
  - [x] `TestRunTerraformApply`: RMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯ã—ã¦applyçµæœæ¤œè¨¼
  - [x] `TestRunTerraformDestroy`: RMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯ã—ã¦destroyçµæœæ¤œè¨¼
  - [x] `TestAutoTerraformInit`: å‰Šé™¤ï¼ˆRMå´ã§ä¸è¦ï¼‰
  - [x] `TestResourceManagerStubs`: å‰Šé™¤ï¼ˆã‚¹ã‚¿ãƒ–ã§ã¯ãªããªã‚‹ï¼‰

- [x] æ–°è¦ãƒ†ã‚¹ãƒˆè¿½åŠ 
  - [x] `_zip_terraform_dir`ã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åŒ…å«/é™¤å¤–ï¼‰
  - [x] `_filter_rm_auto_variables`ã®ãƒ†ã‚¹ãƒˆï¼ˆè‡ªå‹•å…¥åŠ›å¤‰æ•°ã®é™¤å¤–ï¼‰
  - [x] `_get_rm_client`ã®èªè¨¼æ–¹å¼é¸æŠãƒ†ã‚¹ãƒˆï¼ˆResourcePrincipal / API Keyï¼‰
  - [x] `_ensure_rm_stack`ã®æ–°è¦ä½œæˆ/æ›´æ–°ãƒ†ã‚¹ãƒˆ
  - [x] `_run_rm_job`ã®ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚°å–å¾—ãƒ†ã‚¹ãƒˆ
  - [x] `get_rm_job_status`ã®ãƒ†ã‚¹ãƒˆ
  - [x] ã‚¸ãƒ§ãƒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ãƒ†ã‚¹ãƒˆ

- [x] æ’ä»–ãƒ­ãƒƒã‚¯ãƒ»ãƒ‘ã‚¹æ¤œè¨¼ãƒ†ã‚¹ãƒˆã®ç¶­æŒ
  - [x] `TestExclusiveLock`ãŒå¼•ãç¶šãé€šã‚‹ã“ã¨ã‚’ç¢ºèª
  - [x] `TestTerraformDirValidation`ãŒå¼•ãç¶šãé€šã‚‹ã“ã¨ã‚’ç¢ºèª
  - [x] `TestUpdateTerraformFile`ãŒå¼•ãç¶šãé€šã‚‹ã“ã¨ã‚’ç¢ºèª

## ãƒ•ã‚§ãƒ¼ã‚º5: å“è³ªãƒã‚§ãƒƒã‚¯

- [x] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
  - [x] `uv run pytest tests/ -x -q` â†’ 229 passed
- [x] ãƒªãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
  - [x] `uv run ruff check src/ tests/` â†’ All checks passed
- [x] å‹ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
  - [x] `uv run mypy src/` â†’ Success: no issues found

## ãƒ•ã‚§ãƒ¼ã‚º6: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»E2Eãƒ†ã‚¹ãƒˆ

- [x] Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ—ãƒƒã‚·ãƒ¥
  - [x] `docker build -f docker/Dockerfile -t galley .`
  - [x] `docker tag galley kix.ocir.io/orasejapan/galley:preview`
  - [x] `docker push kix.ocir.io/orasejapan/galley:preview`

- [x] ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†èµ·å‹•ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  - [x] `oci container-instances container-instance restart`
  - [x] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèª

- [x] mcp-gaugeã§ãƒªãƒ¢ãƒ¼ãƒˆE2Eãƒ†ã‚¹ãƒˆ
  - [x] Hearing â†’ Design â†’ Export â†’ Plan â†’ Apply ã®å…¨ãƒ•ãƒ­ãƒ¼ç¢ºèªï¼ˆDestroyã¯ãƒªã‚½ãƒ¼ã‚¹æœªä½œæˆã®ãŸã‚çœç•¥ï¼‰
  - [x] `update_terraform_file`ä¸è¦ã§èªè¨¼ãŒè‡ªå‹•å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ï¼ˆResourcePrincipalçµŒç”±ï¼‰
  - [x] ~~ã‚¨ãƒ©ãƒ¼0ã§PASSEDã‚’ç¢ºèª~~ï¼ˆApplyã¯æ­£å¸¸å‹•ä½œã™ã‚‹ãŒVCNã‚¯ã‚©ãƒ¼ã‚¿è¶…éã§å¤±æ•—ã€‚ã‚³ãƒ¼ãƒ‰èµ·å› ã®ã‚¨ãƒ©ãƒ¼ã¯0ï¼‰

- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
  - [x] å®Ÿè£…å¾Œã®æŒ¯ã‚Šè¿”ã‚Šï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸‹éƒ¨ã«è¨˜éŒ²ï¼‰

---

## å®Ÿè£…å¾Œã®æŒ¯ã‚Šè¿”ã‚Š

### å®Ÿè£…å®Œäº†æ—¥
2026-02-25

### è¨ˆç”»ã¨å®Ÿç¸¾ã®å·®åˆ†

**è¨ˆç”»ã¨ç•°ãªã£ãŸç‚¹**:
- `_filter_rm_auto_variables`ï¼ˆRMè‡ªå‹•å…¥åŠ›å¤‰æ•°ã‚’é™¤å¤–ï¼‰ã®è¨­è¨ˆã‚’`_build_rm_variables`ï¼ˆRMå¤‰æ•°ã‚’è‡ªå‹•è¨­å®šï¼‰ã«å¤‰æ›´ã€‚OCI RMã¯APIçµŒç”±ã§ã¯variablesã‚’è‡ªå‹•æ³¨å…¥ã—ãªã„ï¼ˆConsoleçµŒç”±ã®ã¿ï¼‰ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰`region`/`compartment_ocid`/`tenancy_ocid`ã‚’èƒ½å‹•çš„ã«æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ
- `CreateJobDetails`ã®ã‚¸ãƒ§ãƒ–ä½œæˆæ–¹å¼ã‚’å¤‰æ›´ã€‚`operation`+`apply_job_plan_resolution`ã®æ—§ã‚¹ã‚¿ã‚¤ãƒ«ã‹ã‚‰ã€`job_operation_details`ã‚µãƒ–ã‚¯ãƒ©ã‚¹ï¼ˆ`CreatePlanJobOperationDetails`/`CreateApplyJobOperationDetails`/`CreateDestroyJobOperationDetails`ï¼‰ã®æ–°ã‚¹ã‚¿ã‚¤ãƒ«ã«ç§»è¡Œã€‚OCI SDK v2ã®å‹æ¤œè¨¼ã§æ—§ã‚¹ã‚¿ã‚¤ãƒ«ãŒ`str`å‹ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚
- zipã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã®å¤‰æ›´ã€‚`client.create_stack(details, zip_upload=bytes)`ã®kwargæ–¹å¼ã‹ã‚‰ã€`CreateZipUploadConfigSourceDetails(zip_file_base64_encoded=str)`ã®ãƒ¢ãƒ‡ãƒ«å±æ€§æ–¹å¼ã«å¤‰æ›´ã€‚SDKãŒ`zip_upload`kwargsã‚’å—ã‘ä»˜ã‘ãªã„ãŸã‚
- ãƒ­ã‚°å–å¾—APIã®å¤‰æ›´ã€‚`get_job_logs`ï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªï¼‰ã‹ã‚‰`get_job_logs_content`ï¼ˆç”Ÿãƒ†ã‚­ã‚¹ãƒˆï¼‰ã«å¤‰æ›´ã€‚ResourcePrincipalæ¨©é™ã§`get_job_logs`ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ããªã‹ã£ãŸãŸã‚
- `GALLEY_WORK_COMPARTMENT_ID`ç’°å¢ƒå¤‰æ•°ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸï¼ˆTerraform infraå¤‰æ›´ï¼‰

**æ–°ãŸã«å¿…è¦ã«ãªã£ãŸã‚¿ã‚¹ã‚¯**:
- `infra/preview/container-instance.tf`ã«`GALLEY_WORK_COMPARTMENT_ID`ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ï¼ˆRMã‚¹ã‚¿ãƒƒã‚¯ä½œæˆæ™‚ã®compartment_idå–å¾—ã®ãŸã‚ï¼‰
- `_get_tenancy_ocid()`ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ ï¼ˆRP signer / OCI configã‹ã‚‰tenancy OCIDã‚’å–å¾—ï¼‰
- Terraform applyã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†ä½œæˆï¼ˆç’°å¢ƒå¤‰æ•°è¿½åŠ ã®ãŸã‚ï¼‰

### E2Eãƒ†ã‚¹ãƒˆçµæœ

**mcp-gauge E2Eãƒ†ã‚¹ãƒˆï¼ˆrm-migration-e2e-v5ï¼‰**:

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ„ãƒ¼ãƒ« | çµæœ | æ‰€è¦æ™‚é–“ |
|---------|--------|------|---------|
| 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ | create_session | OK | 44ms |
| 2. å›ç­”ä¿å­˜ | save_answers_batch | OK | 66ms |
| 3. ãƒ’ã‚¢ãƒªãƒ³ã‚°å®Œäº† | complete_hearing | OK | 39ms |
| 4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¿å­˜ | save_architecture | OK | 46ms |
| 5. IaCã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | export_iac | OK | 64ms |
| 6. **Planï¼ˆRMçµŒç”±ï¼‰** | run_terraform_plan | **SUCCESS** | 31.3s |
| 7. **Applyï¼ˆRMçµŒç”±ï¼‰** | run_terraform_apply | FAILEDï¼ˆVCNã‚¯ã‚©ãƒ¼ã‚¿è¶…éï¼‰ | 21.1s |

- **Plan**: RMã‚¹ã‚¿ãƒƒã‚¯ä½œæˆâ†’zipã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’Planã‚¸ãƒ§ãƒ–å®Ÿè¡Œâ†’ãƒ­ã‚°å–å¾—â†’plan_summaryæŠ½å‡ºã€ã™ã¹ã¦æ­£å¸¸å‹•ä½œ
- **Apply**: RMã‚¸ãƒ§ãƒ–è‡ªä½“ã¯æ­£å¸¸å‹•ä½œã€‚å¤±æ•—åŸå› ã¯OCIã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®VCNã‚¯ã‚©ãƒ¼ã‚¿è¶…éï¼ˆ`QuotaExceeded: vcn-count`ï¼‰ã§ã‚³ãƒ¼ãƒ‰èµ·å› ã§ã¯ãªã„
- **èªè¨¼**: ResourcePrincipalçµŒç”±ã§è‡ªå‹•å‡¦ç†ã€‚`update_terraform_file`ã«ã‚ˆã‚‹èªè¨¼è¨­å®šã¯ä¸è¦
- **ã‚¨ãƒ©ãƒ¼æ§‹é€ åŒ–**: Applyå¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãŒ`TerraformErrorDetail`ã¨ã—ã¦æ­£ã—ãæ§‹é€ åŒ–ã•ã‚ŒãŸ
- **å…¨ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—**: ã‚¨ãƒ©ãƒ¼0ä»¶ã€å†—é•·å‘¼ã³å‡ºã—0ä»¶

### å­¦ã‚“ã ã“ã¨

**æŠ€è¡“çš„ãªå­¦ã³**:
- OCI Resource Manager APIã§ã¯`region`/`compartment_ocid`/`tenancy_ocid`ã¯è‡ªå‹•æ³¨å…¥ã•ã‚Œãªã„ã€‚Console UIçµŒç”±ã®ã¿ã®æ©Ÿèƒ½ã§ã‚ã‚Šã€APIåˆ©ç”¨æ™‚ã¯stack variablesã¨ã—ã¦æ˜ç¤ºçš„ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚‹
- OCI Python SDK v2ã§ã¯`CreateJobDetails`ã®`apply_job_plan_resolution`ã«æ–‡å­—åˆ—ã‚’æ¸¡ã™ã¨å‹ã‚¨ãƒ©ãƒ¼ã€‚`job_operation_details`ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã®`execution_plan_strategy`å±æ€§ã‚’ä½¿ã†
- `create_stack`/`update_stack`ã®zipã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯`zip_upload`kwargsã§ã¯ãªãã€`ConfigSourceDetails`ãƒ¢ãƒ‡ãƒ«ã®`zip_file_base64_encoded`å±æ€§ã§æ¸¡ã™
- `get_job_logs`ã¨`get_job_logs_content`ã¯ç•°ãªã‚‹APIã€‚å¾Œè€…ã¯ç”Ÿãƒ†ã‚­ã‚¹ãƒˆã‚’è¿”ã—ã€ResourcePrincipalæ¨©é™ã§ã‚‚å‹•ä½œã™ã‚‹
- RMã‚¸ãƒ§ãƒ–ã®æ‰€è¦æ™‚é–“: Planç´„25ç§’ã€Applyç´„15ç§’ï¼ˆTerraformå®Ÿè¡Œéƒ¨åˆ†ã€‚ãƒãƒ¼ãƒªãƒ³ã‚°å«ã‚€å…¨ä½“ã¯ç´„20-30ç§’ï¼‰

**ãƒ—ãƒ­ã‚»ã‚¹ä¸Šã®æ”¹å–„ç‚¹**:
- E2Eãƒ†ã‚¹ãƒˆã§æ®µéšçš„ã«ãƒã‚°ã‚’ç™ºè¦‹ãƒ»ä¿®æ­£ã§ããŸï¼ˆzip_uploadâ†’å¤‰æ•°æœªè¨­å®šâ†’ã‚¸ãƒ§ãƒ–ä½œæˆå‹ã‚¨ãƒ©ãƒ¼â†’ãƒ­ã‚°å–å¾—ï¼‰
- mcp-gaugeã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã«ã‚ˆã‚Šã€å„ã‚¹ãƒ†ãƒƒãƒ—ã®æˆåŠŸ/å¤±æ•—ã‚’æ˜ç¢ºã«åˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚ŒãŸ

### æ¬¡å›ã¸ã®æ”¹å–„ææ¡ˆ
- OCI SDK APIã®å®Ÿéš›ã®å‹•ä½œã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ç•°ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚E2Eãƒ†ã‚¹ãƒˆã‚’æ—©æœŸã«å®Ÿæ–½ã—ã¦æ¤œè¨¼ã™ã¹ã
- RMã‚¹ã‚¿ãƒƒã‚¯ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ï¼ˆä¸è¦ã«ãªã£ãŸã‚¹ã‚¿ãƒƒã‚¯ã®è‡ªå‹•å‰Šé™¤ï¼‰ã®è¿½åŠ ã‚’æ¤œè¨
- VCNã‚¯ã‚©ãƒ¼ã‚¿ä¸Šé™ã®ç¢ºèªãƒ»æ‹¡å¼µç”³è«‹ãŒå¿…è¦ï¼ˆE2Eãƒ†ã‚¹ãƒˆã®å®Œå…¨ãªApplyâ†’Destroyç¢ºèªã®ãŸã‚ï¼‰
