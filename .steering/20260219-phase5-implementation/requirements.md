# 要求内容

## 概要

Phase 5（アプリケーション層）の実装。テンプレートストア（F11）とアプリケーションカスタマイズ・デプロイ（F12）機能をMCPツールとして提供し、プレビュー版コンテナイメージをビルド・プッシュする。

## 背景

Phase 1-4でヒアリング、設計、インフラ層が実装済み。Phase 5ではアプリケーションテンプレートの管理と、テンプレートからのプロジェクト生成、コードカスタマイズ、ビルド・デプロイまでの機能を追加する。これによりヒアリング→設計→インフラ構築→アプリデプロイの一連フローが完成する。

## 実装対象の機能

### 1. F11: テンプレートストア

- `list_templates` — 利用可能なテンプレート一覧（名称、説明、カスタマイズポイント）を返す
- `scaffold_from_template` — テンプレートからプロジェクトを生成（パラメータ付き）
- テンプレートは `config/templates/` にマスター管理（ファイルシステムベース、将来Object Storage対応）
- `template.json` でメタデータを定義

### 2. F12: アプリケーションカスタマイズとデプロイ

- `update_app_code` — LLMによるアプリコードのカスタマイズ
- `build_and_deploy` — ビルド→OCIR push→OKEデプロイを一括実行
- `check_app_status` — デプロイ状態・ログ・ヘルスチェック結果を返す
- カスタマイズ前のコードスナップショット保存（ロールバック対応）
- テンプレートのコア部分（protected_paths）はカスタマイズ不可

### 3. プレビュー版コンテナイメージ

- previewブランチでコンテナイメージをビルド
- `preview` タグでOCIRにプッシュ

## 受け入れ条件

### F11: テンプレートストア
- [ ] `list_templates` でテンプレート一覧が取得できる
- [ ] `scaffold_from_template` でテンプレートからプロジェクトを生成できる
- [ ] テンプレートメタデータ（template.json）の構造が定義されている
- [ ] テンプレートが存在しない場合の適切なエラーハンドリング

### F12: アプリケーションカスタマイズとデプロイ
- [ ] `update_app_code` でアプリコードを更新できる
- [ ] `build_and_deploy` でビルド・デプロイが実行できる
- [ ] `check_app_status` でデプロイ状態が確認できる
- [ ] protected_pathsによるコア部分の保護が機能する
- [ ] カスタマイズ前にスナップショットが保存される

### コンテナイメージ
- [ ] previewタグでOCIRにイメージがプッシュされている

## スコープ外

- 実際のOKEデプロイ連携（build_and_deployはスタブ実装）
- 実際のOCI DevOpsパイプライン連携
- Object Storageベースのテンプレートストア（ファイルシステムベースで実装）

## 参照ドキュメント

- `docs/product-requirements.md` - F11, F12の要件
- `docs/functional-design.md` - AppService, データモデル
- `docs/architecture.md` - アーキテクチャ設計書
- `docs/repository-structure.md` - リポジトリ構造定義書
